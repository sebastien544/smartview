<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="listings.title">Annonces — SmartView</title>
  <meta name="description" content="Toutes les annonces disponibles" />
  <link rel="stylesheet" href="styles-light.css" />
</head>

<body>
  <div id="site-header"></div>

  <main class="main-content">
    <section class="container" style="padding-top:28px">
      <div class="section-title" style="display: flex; flex-direction: column;align-items: flex-start;">
        <div>
          <h2 data-i18n="listings.title">Annonces</h2>
          <p data-i18n="listings.subtitle">Toutes les propriétés disponibles — filtrez et contactez-nous.</p>
        </div>
        <div class="" aria-label="Recherche de biens" data-i18n-aria="search.aria" style="display:flex; gap:10px; align-items:center;">
         <form id="searchForm" class="" onsubmit="rechercher(event); return false;">
              <div class="search-row" style="display: flex;align-items: center;">
                <!-- <div class="field">
                  <label for="q" data-i18n="search.cityLabel">Ville / Quartier</label>
                  <input id="q" name="q" placeholder="Ex. Hua Hin, Part-Dieu" autocomplete="off"
                    data-i18n-placeholder="search.cityPlaceholder" />
                </div>-->

                <div class="field">
                  <label for="type" data-i18n="search.typeLabel">Type</label>
                  <select id="type" name="type">
                    <option value="all" data-i18n="search.all">Tous</option>
                    <option value="appartement" data-i18n="type.apartment">Appartement</option>
                    <!-- <option value="maison" data-i18n="type.house">Maison</option> -->
                    <option value="villa" data-i18n="type.villa">Villa</option>
                    <option value="bureau" data-i18n="type.office">Bureau</option>
                  </select>
                </div>

               <!-- <div class="field">
                  <label for="transaction" data-i18n="search.transactionLabel">Transaction</label>
                  <select id="transaction" name="transaction">
                    <option value="all" data-i18n="search.buyOrRent">Achat / Location</option>
                    <option value="achat" data-i18n="transaction.buy">Achat</option>
                    <option value="location" data-i18n="transaction.rent">Location</option>
                  </select>
                </div> -->

                <div class="field">
                  <label for="budget" data-i18n="search.budgetLabel">Budget max</label>
                  <select id="budget" name="budget">
                    <option value="all" data-i18n="search.noLimit">Sans limite</option>
                    <option value="1000000">1 000 000 ฿</option>
                    <option value="2000000">2 000 000 ฿</option>
                    <option value="3000000">3 000 000 ฿</option>
                    <option value="4000000">4 000 000 ฿</option>
                    <option value="5000000">5 000 000 ฿</option>
                  </select>
                </div>

                <button class="btn primary" type="submit" aria-label="Rechercher" data-i18n="search.submit" style="margin-top:1em;">
                  Rechercher
                </button>
              </div>
            </form>
            <button class="btn small ghost" id="resetBtn" type="button" data-i18n="listings.reset" onclick="reinit()" style="margin-top:1em;">
              Réinitialiser
            </button>
            </div>
      </div>

      <div class="grid" id="listings" aria-live="polite"></div>

      <div id="pagination" style="margin-top:20px;"></div>

      <p id="emptyState" class="hide" style="color:var(--muted); font-weight:750; margin-top:14px;" data-i18n="listings.empty">Aucun bien ne correspond à votre recherche.</p>
    </section>
  </main>

  <div id="site-footer"></div>

  <script src="JS/main.js" defer></script>
  <script src="JS/i18n.js" defer></script>
  <script src="JS/core.js" defer></script>
  <script src="JS/properties.js" defer></script>
  <script>
    let ITEMS_PER_PAGE = 12;       // nombre d’annonces par page
    let currentPage = 1;           // page affichée
    //let currentList = [];

     function rechercher(e) {
     e.preventDefault();
      const data = new FormData(e.target);
      const type = data.get('type') || 'all';
      const budget = data.get('budget') || 'all';
      currentList = PROPERTIES_LOCALIZED().filter(p => {
        const matchesType   = (type === 'all' || p.type === type);
        const matchesBudget = (budget === 'all' || p.price <= parseInt(budget));
        return matchesType && matchesBudget;
      });
      renderPage(1); // affiche la première page des résultats filtrés
    }

    function reinit() {
      document.getElementById('searchForm').reset();
      currentList = PROPERTIES;
      renderPage(1);
    }

     function renderPage(page) {
      currentPage = page;
      const totalPages = Math.ceil(currentList.length / ITEMS_PER_PAGE);
      const start = (page - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageItems = currentList.slice(start, end);
      render(pageItems);  // utilise la fonction existante pour afficher uniquement la tranche
      updatePaginationControls(totalPages);
    }

  function updatePaginationControls(totalPages) {
    const container = document.getElementById('pagination');
    container.innerHTML = '';
    if (totalPages <= 1) return;

    // bouton « Précédent »
    const prev = document.createElement('button');
    prev.textContent = 'Précédent';
    prev.disabled = (currentPage === 1);
    prev.onclick = () => renderPage(currentPage - 1);
    container.appendChild(prev);

    // boutons numérotés
    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.classList.toggle('active', i === currentPage);
      btn.onclick = () => renderPage(i);
      container.appendChild(btn);
    }

    // bouton « Suivant »
    const next = document.createElement('button');
    next.textContent = 'Suivant';
    next.disabled = (currentPage === totalPages);
    next.onclick = () => renderPage(currentPage + 1);
    container.appendChild(next);
   }
  </script>
</body>
</html>
